language: rust
rust:
- stable
- beta
- nightly

arch:
  - amd64
  - arm64

matrix:
  allow_failures:
  - rust: nightly

before_install:
  - sudo apt-get -qq update
  - sudo apt-get install -y musl-tools

script:
- TARGET=`[ $TRAVIS_CPU_ARCH == 'amd64' ] && echo x86_64 || echo aarch64`-unknown-linux-musl
- rustup target add $TARGET
- cargo test --target=$TARGET
- cargo build --release --target=$TARGET
- strip -s target/$TARGET/release/sausagewiki
- XZ_OPT=-9 tar Jcf sausagewiki-$TRAVIS_CPU_ARCH.tar.xz -C target/$TARGET/release/ sausagewiki

branches:
  except:
  - "/^untagged-/"
